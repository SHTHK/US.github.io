<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>U.S.P.C - 연합특수치안공사</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Lucide Icons (Vanilla) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              mono: ['"Courier Prime"', 'monospace'],
              sans: ['"Noto Sans KR"', 'sans-serif'],
            },
            colors: {
              folder: {
                light: '#fdf6e3',
                base: '#f5e6ca',
                dark: '#e0d0b0',
                tab: '#eaddcf'
              },
              ink: {
                black: '#1a1a1a',
                blue: '#2c3e50',
                red: '#c0392b'
              }
            },
            backgroundImage: {
              'paper-pattern': "url('https://www.transparenttextures.com/patterns/cardboard.png')"
            }
          }
        }
      }
    </script>
    <style>
      body {
        background-color: #2f3136; /* Dark desk background */
      }
      .stamp-box {
        mask-image: url('https://www.transparenttextures.com/patterns/grunge-wall.png');
        -webkit-mask-image: url('https://www.transparenttextures.com/patterns/grunge-wall.png');
      }
      /* Animation utils */
      @keyframes fade-in {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fade-in 0.5s ease-out forwards;
      }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans selection:bg-amber-200 selection:text-amber-900 pb-10 text-stone-800">

    <!-- Header -->
    <header class="bg-stone-900 text-white p-4 shadow-lg border-b-4 border-amber-600 relative overflow-hidden z-20">
        <div class="absolute top-0 right-0 p-2 opacity-10 pointer-events-none">
           <i data-lucide="building" width="120" height="120"></i>
        </div>
        <div class="max-w-6xl mx-auto flex justify-between items-end">
          <div>
            <h1 class="text-3xl md:text-5xl font-black tracking-tighter font-sans">U.S.P.C</h1>
            <h2 class="text-sm md:text-lg font-mono text-amber-500 tracking-widest mt-1">
              UNION SPECIAL POLICING CORP.
            </h2>
            <p class="text-xs text-stone-400 mt-1">연합특수치안공사</p>
          </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app" class="flex-1 max-w-7xl mx-auto w-full p-4 mt-4 relative perspective-1000">
        <!-- Dynamic Content will be injected here -->
    </main>

    <!-- Application Logic -->
    <script>
        // --- DATA ---
        const TEAMS = {
            'TEAM_1': {
                id: 'TEAM_1',
                name: "제 1팀",
                engName: "TEAM 1",
                description: "용사 가문 혈족으로 구성된 특수 제압 부대. 실적 1위, 민원 발생 1위.",
                themeColor: "text-red-800",
                icon: "shield-alert",
                folderClass: "bg-red-50 hover:bg-red-100 border-red-200",
                iconClass: "text-red-700"
            },
            'TEAM_2': {
                id: 'TEAM_2',
                name: "제 2팀",
                engName: "TEAM2",
                description: "국가 공인 엘리트 요원들. 1팀의 비상식적인 무력에 밀려 만년 2등이다.",
                themeColor: "text-blue-900",
                icon: "shield",
                folderClass: "bg-blue-50 hover:bg-blue-100 border-blue-200",
                iconClass: "text-blue-700"
            },
            'TEAM_3': {
                id: 'TEAM_3',
                name: "제 3팀",
                engName: "TEAM 3",
                description: "뒷처리 전담반. 행정력과 정신력만은 최강.",
                themeColor: "text-emerald-800",
                icon: "heart-pulse",
                folderClass: "bg-emerald-50 hover:bg-emerald-100 border-emerald-200",
                iconClass: "text-emerald-700"
            }
        };

        const CHARACTERS = [
            // TEAM 1
            {
                id: 'CA', teamId: 'TEAM_1', name: '카스텔', rank: 'TANK', gender: '여', age: '24세', race: '인간', jobClass: '대검사',
                curse: `반경 1km내의 모든 적의가 카스텔을 향한다. 적의는 물리적, 정신적 적의를 모두 포함한다.<br>과거에는 마을을 위해 미끼로 내던져져서 죽는 경우가 많았지만, 현대엔 온갖 초고가 최신 장비로 떡칠해 웬만하면 죽지 않는 미끼가 되었다.`, curseLabel: '희생의 저주',
                appearance: '입고 다니는 메카 수트는 본래 자신의 덩치보다 두 배는 더 크다.', personality: `ISTJ, 6w5 sp/so<br>어려보이는 외모에 비해 굉장히 염세주의적이다. 안 좋은 일에 많이 휘말리는 만큼 억울함이 많다. 3팀 못지 않은 멘탈을 가지고 있지만, 그걸 상쇄할 정도로 멘탈을 박살낼 일이 많이 일어나서 티가 안 난다.`, features: '장비 비용으로 공사 예산을 삭제시키는 세금 흡입기라고 할 수 있다. 고장이라도 나면 본인 연봉도 깎이는 거 같다던데... 장비 없이도 상식을 초월하는 방어력을 가지고 있지만, U.S.P.C 입장에선 혹시라도 유용한 미끼가 사라지면 안 되니까 장비에 카스텔 본인보다도 심혈을 기울이고 있다.',
                quote: "장빗값은... 비밀로 할게요.", avatarUrl: 'CA_TN.png', portraitUrl: 'CA2_cowboyshot3.png',
                stats: { attack: 70, defense: 90, magic: 63, admin: 30 }, status: 'OVERTIME'
            },
            {
                id: 'N', teamId: 'TEAM_1', name: '네로', rank: 'PHYS DEAL', gender: '남', age: '23세', race: '검은 고양이 수인', jobClass: '암살자',
                curse: '자신을 제외한 주변 사물/환경에 불운이 닥친다. 적의 기지에 침입하기만 해도 건물의 모든 전선이 합선되어 버리는 마법을 볼 수 있다.<br>과거엔 재앙의 씨앗이라 불리며 처형 당하기 일수였으나, U.S.P.C는 그를 적들을 자멸시키는 병기로 사용하기로 했다. 갑자기 레고를 밟았다면 그를 먼저 의심하라.', curseLabel: '불운의 저주',
                appearance: '암살자라지만 적진 어딘가에 숨어서 지루할 정도로 가만히 있는 것이 주 임무이기 때문에, 어디서든 낮잠을 잘 수 있도록 수면안대를 머리 위에 걸치고 다닌다.', personality: 'INTP, 9w8 sp/sx<br>말도 안 되는 불운을 보고 살면서도 자신에겐 불운이 닥치지 않다 보니 안전불감증이 있다. 귀찮음도 많은데, 그런 면에서 딱 맞는 업무를 맡았다고 할 수 있다.', features: '자신과 가까워졌다가는 타인이 불행해질 거라고 생각하기 때문에 일부러 정을 주지 않는다.',
                quote: "정수기가 망가졌다고요? ...저 정수기 안 만졌어요.", avatarUrl: 'N_TN.png', portraitUrl: 'N_cowboyshot3.png',
                stats: { attack: 95, defense: 61, magic: 65, admin: 0 }, status: 'DUTY'
            },
            {
                id: 'L', teamId: 'TEAM_1', name: '라리타', rank: 'MAGIC DEAL', gender: '여', age: '220세', race: '서큐버스', jobClass: '마법사',
                curse: '무작위 한 가지 재능이 매우 뛰어나지만 그 대가로 왕과 귀족의 시기, 질투, 모함을 받게 된다.<br>결국 시기하는 자들의 모함으로 처형되는 것이 일반적인 경우였지만, 신분제가 폐지되면서 더 이상 저주가 아니게 되었다. 그녀에겐 질투 또한 관심일 뿐.', curseLabel: '질투의 저주',
                appearance: '노출 없는 정장이야말로 세상에서 가장 섹시한 옷이다.', personality: 'ESTJ, 3w4 so/sp<br>자아도취, 연예인병. 인기에 집착하는 모습을 보인다. 나름 소녀감성을 가지고 있다.', features: '사상최초 공무원 아이돌. 팬들을 매우 아끼지만, 팬만큼 안티도 많다.',
                quote: "어머, 화장이 망가졌네? 뭐, 난 화장 없이도 예쁘지만~", avatarUrl: 'L_TN.png', portraitUrl: 'L_cowboyshot3.png',
                stats: { attack: 67, defense: 76, magic: 99, admin: 32 }, status: 'DUTY'
            },
            {
                id: 'T', teamId: 'TEAM_1', name: '타스', rank: 'HEAL', gender: '남', age: '불명', race: '엘프', jobClass: '치유사',
                curse: '숨이 끊어지는 순간 특정 261세의 육체로 부활한다.<br>초대 용사는 깊이 사랑하는 사람이 있었기에 그 사람이 죽는 걸 지켜봐야만하는 저주였지만, 사람보다 과학을 사랑하는 타스에겐 아니다. 저주 덕분에 \'자가 생체 실험\'이 가능해져서 학계의 살아있는 전설이 됐다.', curseLabel: '불사의 저주',
                appearance: '늘 메고 다니는 탱크는 약물로 가득 차 있다. 매일 종류가 바뀌는 거 같은데, 몸에 어떤 영향을 줄지 모르므로 웬만하면 첫 번째로 다치는 건 피하는 것이 좋다. 자신보다 먼저 다친 사람을 실험쥐로 만들어라.', personality: '말투는 느긋하지만 항상 묘하게 신나있다. 윤리라는 것을 알기는 하는 건지 의심된다.', features: '연구비로 사용하기 위해 사망 보험금을 여러번 타 먹으려다가 보험사 블랙리스트 0순위에 등재되었다.',
                quote: "약이 너무 많지 않냐고? 아아... 걱정 마. 이 정도는 괜찮을 거야...", avatarUrl: 'T_TN.png', portraitUrl: 'T_cowboyshot3.png',
                stats: { attack: 65, defense: 70, magic: 65, admin: 20 }, status: 'DUTY'
            },
            // TEAM 2
            {
                id: 'V', teamId: 'TEAM_2', name: '빅터', rank: 'TANK', gender: '남', age: '273세', race: '드라고니안', jobClass: '마도공학자',
                appearance: '건틀렛은 직접 만든 것이다. 카스텔의 장비에 쓰이는 예산의 반의 반만이라도 자신의 건틀렛에 쓰이길 염원한다.', personality: 'INTJ, 1w2 so/sp<br>완벽주의 노력파. 독설가이지만, 그가 하는 모든 독설은 제 1팀의 몰상식한 힘 앞에서 흩어져버린다.', features: '수석 입사 엘리트. 교과서적인 공무원이다. 인생을 살아오면서 \'실패\'라는 것을 겪어본 적 없던 그였지만, 1팀이라는 벽에 부딫혀버렸다. 1팀을 극도로 혐오한다.',
                quote: "2팀의 실적은 훌륭합니다. 1팀 자식... 아니, 1팀 분들이 무식할 정도로 높은 거죠.", avatarUrl: 'V_TN.png', portraitUrl: 'V_cowboyshot3.png',
                stats: { attack: 43, defense: 65, magic: 43, admin: 60 }, status: 'DUTY'
            },
            {
                id: 'LU', teamId: 'TEAM_2', name: '루스', rank: 'PHYS DEAL', gender: '여', age: '25세', race: '늑대 수인', jobClass: '격투가',
                appearance: '꼬리가 매우 폭신폭신하고 부드럽다.', personality: 'ESFJ, 2w1 so/sx<br>대형견 스타일. 강철 멘탈에 긍정왕이다. 제 2팀의 힐링 담당.', features: '2팀의 팀원들 중 유일하게 1팀에 대한 열등감이 없다. 가끔 파괴 충동이 드는데, 그냥 참거나 대련 같은 건강한 방식으로 해소하기를 택한다.',
                quote: "오늘도 좋은 아침! 자, 다들 그렇게 축 처져 있지 말고! 힘내자!", avatarUrl: 'LU_TN.png', portraitUrl: 'LU_cowboyshot3.png',
                stats: { attack: 63, defense: 58, magic: 0, admin: 30 }, status: 'DUTY'
            },
            {
                id: 'H', teamId: 'TEAM_2', name: '하이마', rank: 'MAGIC DEAL', gender: '남', age: '238세', race: '뱀파이어', jobClass: '저격수',
                appearance: '빨간색은 눈에 띄기 때문에 쓰지 말라고 했지만, 꾸역꾸역 안쪽 옷감에 집어넣었다.', personality: 'ISTP, 4w3, sp/sx<br>쿨한 척을 하고, 실제로 어느 정도는 쿨해 보인다. 내적 관종에 질투와 시기가 많다.', features: '신경 안 쓰는 척 하지만 사실 1팀을 가장 신경 쓰고 있다. 나잇값을 약간 못 한다.',
                quote: "흥, 저런 걸로 놀라는 건가? 저 정도는 우리도 할 수 있다.", avatarUrl: 'H_TN.png', portraitUrl: 'H_cowboyshot3.png',
                stats: { attack: 41, defense: 43, magic: 70, admin: 5 }, status: 'DUTY'
            },
            {
                id: 'B', teamId: 'TEAM_2', name: '벨리알', rank: 'HEAL', gender: '여', age: '불명', race: '천족', jobClass: '치유사',
                appearance: '헤일로에서 나오는 빛은 야근 중 전기 절약에 유용하다.', personality: 'INFP, 4w5 sp/so<br>음침하고 속을 알 수가 없다. 생명을 경시하는 경향이 있다.', features: '지속적 치유 능력은 없으나 죽기 직전인 사람에게 대회복을 사용할 수 있다. 1팀을 이기기 위해서 끝없이 일해야 한다고 생각하기 때문에, 대회복을 써서 매일 야근을 시킨다.',
                quote: "후후, 어딜 가시려고요...? 야근 시간은 한참 남았답니다...", avatarUrl: 'B_TN.png', portraitUrl: 'B_cowboyshot3.png',
                stats: { attack: 37, defense: 37, magic: 60, admin: 45 }, status: 'DUTY'
            },
            // TEAM 3
            {
                id: 'M', teamId: 'TEAM_3', name: '마르가리타', rank: 'JANITOR', gender: '여', age: '22세', race: '슬라임', jobClass: '청소부',
                appearance: '메이드복은 녹지 않는 특수 소재로 만들어졌다.', personality: 'ISFJ, 6w5 sp/so<br>극도로 소심하다. 자신의 잘못이 아닌 일에도 늘 자책을 하며, 사과가 습관이다.', features: '전투 능력이 2팀에 맞먹지만, 스스로를 과소평가하여 3팀에 지원했다. 청소부 일에도 뛰어나다. 쓰레기를 몸에 넣어서 녹여버린다.',
                quote: "죄, 죄송해요... 제가 빨리 치울게요!", avatarUrl: 'M_TN.png', portraitUrl: 'M_cowboyshot3.png',
                stats: { attack: 70, defense: 50, magic: 30, admin: 85 }, status: 'DUTY'
            },
            {
                id: 'O', teamId: 'TEAM_3', name: '오스', rank: 'REP', gender: '남', age: '298세', race: '인큐버스', jobClass: '상담원',
                appearance: '원래는 정장 재킷까지 챙겨입었지만, 열 받을 일이 너무 많아서 벗어버렸다.', personality: 'ENFJ, 2w3 so/sx<br>친절한 모습이지만, 실은 강박적인 친절이며 속은 피로로 가득하다. 공사구분이 확실하다.', features: '제 3팀에서, 아니, 회사 전체에서 커피를 가장 많이 마신다. 업무 안 할 땐 후줄근한 모습으로 있는다.',
                quote: "그런 점이 불편하셨군요. 저희가 조치하겠습니다.", avatarUrl: 'O_TN.png', portraitUrl: 'O_cowboyshot3.png',
                stats: { attack: 28, defense: 35, magic: 39, admin: 95 }, status: 'DUTY'
            },
            {
                id: 'LI', teamId: 'TEAM_3', name: '리네아', rank: 'REBUILDER', gender: '여', age: '28세', race: '아라크네', jobClass: '재건가',
                appearance: '머리 위에 있는 것들은 진짜 눈이 아닌 머리핀이다.', personality: 'ESFJ, 2w3 so/sx<br>오지랖이 넓고 타인을 걱정하는 마음이 크다. 엄마 같다고 느껴질 정도.', features: '거미줄로 제 1팀, 제 2팀이 박살낸 건물을 복구시킨다. 휴식을 소홀히 하면 리네아의 거미줄에 붙어서 강제로 쉬게 될 것이다.',
                quote: "어머, 그렇게 몸을 혹사하면 못쓴단다... 좀 쉬렴.", avatarUrl: 'LI_TN.png', portraitUrl: 'LI_cowboyshot3.png',
                stats: { attack: 33, defense: 35, magic: 33, admin: 82 }, status: 'DUTY'
            },
            {
                id: 'VI', teamId: 'TEAM_3', name: '위시타', rank: 'WATCHER', gender: '남', age: '불명', race: '비홀더', jobClass: '감시원',
                appearance: '촉수에 달려있는 눈은 비정상적으로 먼 거리를 볼 수 있다.', personality: 'INTJ, 5w6 sp/so<br>편집증이 있으며, 까칠하다. 츤데레 같은 면이 있다.', features: '사고 현장을 녹화하고 감시한다. 한 번에 여러 시야를 볼 수 있지만, 멀미라는 부작용을 겪는다. 덕분에 멀미약을 달고 산다.',
                quote: "어, 언제부터 옆에 있던 거야?! 깜짝 놀라게 하지 말라고!", avatarUrl: 'VI_TN.png', portraitUrl: 'VI_cowboyshot2_3.png',
                stats: { attack: 17, defense: 22, magic: 39, admin: 81 }, status: 'DUTY'
            }
        ];

        // --- STATE ---
        let selectedTeamId = null;
        let selectedCharacterId = null;
        let isKimHeroAwakened = false;

        // --- NAVIGATION & HISTORY ---

        function initRouter() {
            try {
                // Handle initial load based on hash
                const hash = window.location.hash;
                if (hash.startsWith('#char=')) {
                    const id = hash.replace('#char=', '');
                    if (CHARACTERS.find(c => c.id === id)) {
                        selectCharacter(id, true);
                        return;
                    }
                } else if (hash.startsWith('#team=')) {
                    const id = hash.replace('#team=', '');
                    if (TEAMS[id]) {
                        selectTeam(id, true);
                        return;
                    }
                }
                
                // Default to Home
                // Wrap in try-catch to prevent crashes in restricted environments (e.g. file://)
                try {
                    history.replaceState({ view: 'home' }, '', '#');
                } catch (e) {
                    console.warn("History API restricted, proceeding without history updates.");
                }
                renderHome();
            } catch (e) {
                console.error("Router Init Failed:", e);
                // Fallback to home rendering if something critical failed
                renderHome();
            }
        }

        window.addEventListener('popstate', (event) => {
            const state = event.state;
            isKimHeroAwakened = false; // Reset local state on nav

            if (!state || state.view === 'home') {
                selectedTeamId = null;
                selectedCharacterId = null;
                renderHome();
            } else if (state.view === 'team') {
                selectedTeamId = state.teamId;
                selectedCharacterId = null;
                renderTeamDetail();
            } else if (state.view === 'character') {
                selectedCharacterId = state.characterId;
                const char = CHARACTERS.find(c => c.id === selectedCharacterId);
                if (char) {
                    selectedTeamId = char.teamId;
                    renderCharacterDetail();
                } else {
                    renderHome();
                }
            }
        });

        // --- ACTIONS ---

        function selectTeam(id, replace = false) {
            selectedTeamId = id;
            selectedCharacterId = null;
            
            const state = { view: 'team', teamId: id };
            const url = `#team=${id}`;
            
            try {
                if (replace) history.replaceState(state, '', url);
                else history.pushState(state, '', url);
            } catch (e) {
                console.warn("History API restricted.");
            }

            renderTeamDetail();
        }

        function selectCharacter(id, replace = false) {
            selectedCharacterId = id;
            isKimHeroAwakened = false;

            const state = { view: 'character', characterId: id };
            const url = `#char=${id}`;
            
            try {
                if (replace) history.replaceState(state, '', url);
                else history.pushState(state, '', url);
            } catch (e) {
                console.warn("History API restricted.");
            }

            renderCharacterDetail();
        }

        function goBack() {
            if (selectedCharacterId) {
                const char = CHARACTERS.find(c => c.id === selectedCharacterId);
                selectTeam(char.teamId);
            } else if (selectedTeamId) {
                selectedTeamId = null;
                try {
                    history.pushState({ view: 'home' }, '', '#');
                } catch(e) { console.warn("History API restricted."); }
                renderHome();
            }
        }
        
        function toggleAwakening() {
            isKimHeroAwakened = !isKimHeroAwakened;
            renderCharacterDetail();
        }

        // --- RENDER HELPERS ---
        function getStatBarHTML(label, value, maxValue = 100) {
            const percentage = Math.min((value / maxValue) * 100, 100);
            let barColor = 'bg-stone-500';
            if (value > 80) barColor = 'bg-red-700';
            else if (value > 50) barColor = 'bg-amber-600';
            else if (value > 30) barColor = 'bg-blue-600';

            return `
            <div class="flex items-center gap-4 text-xs font-mono mb-2">
                <div class="w-24 text-right font-bold text-stone-700">${label.toUpperCase()}</div>
                <div class="flex-1 h-3 bg-stone-200 border border-stone-400 relative">
                <div class="h-full ${barColor} transition-all duration-500" style="width: ${percentage}%"></div>
                <div class="absolute top-0 left-0 w-full h-full grid grid-cols-10 pointer-events-none">
                    ${Array(10).fill('<div class="border-r border-stone-400/30 h-full"></div>').join('')}
                </div>
                </div>
                <div class="w-8 font-bold text-stone-600">${value}</div>
            </div>
            `;
        }

        function getStampHTML(text, color = 'red', rotate = -12, className = '') {
            const colorClass = {
                red: 'border-red-700 text-red-700',
                blue: 'border-blue-800 text-blue-800',
                black: 'border-gray-800 text-gray-800'
            }[color];
            return `
                <div class="absolute z-10 select-none pointer-events-none opacity-80 mix-blend-multiply ${className}" style="transform: rotate(${rotate}deg)">
                    <div class="border-4 border-double ${colorClass} px-4 py-1 font-black text-xl uppercase tracking-widest stamp-box">
                        ${text}
                    </div>
                </div>
            `;
        }

        function getBackStampHTML(action, label) {
            return `
            <button onclick="${action}" class="group flex items-center gap-2 text-stone-600 hover:text-red-700 transition-colors mb-4 md:mb-0 md:absolute md:top-6 md:left-6 z-30 cursor-pointer">
                <div class="border-2 border-stone-400 group-hover:border-red-700 rounded-full p-2 bg-stone-100 group-hover:bg-red-50 transition-all">
                <i data-lucide="arrow-left" width="20" height="20" class="transform group-hover:-translate-x-1 transition-transform"></i>
                </div>
                <span class="font-mono font-bold text-sm tracking-widest border-b-2 border-transparent group-hover:border-red-700">
                ${label}
                </span>
            </button>
            `;
        }

        // --- VIEWS ---

        function renderHome() {
            const container = document.getElementById('app');
            const teamsHTML = Object.values(TEAMS).map(team => `
                <button onclick="selectTeam('${team.id}')" class="relative h-80 rounded-xl border-2 p-6 flex flex-col items-center justify-center text-center transition-all transform hover:-translate-y-2 hover:shadow-xl group ${team.folderClass} cursor-pointer w-full">
                    <div class="absolute top-0 left-0 w-32 h-8 -mt-8 rounded-t-lg border-t-2 border-l-2 border-r-2 bg-white/50 ${team.folderClass} border-inherit opacity-80"></div>
                    <div class="mb-4 p-4 rounded-full bg-white shadow-sm ${team.iconClass}">
                        <i data-lucide="${team.icon}" width="48" height="48" stroke-width="1.5"></i>
                    </div>
                    <h3 class="text-xl font-black font-sans mb-1 ${team.themeColor}">${team.name}</h3>
                    <p class="text-xs font-mono font-bold text-stone-500 uppercase tracking-wider mb-4">${team.engName}</p>
                    <p class="text-sm text-stone-600 line-clamp-3 leading-relaxed px-2 font-serif italic mb-4">"${team.description}"</p>
                    <div class="mt-auto pt-4 opacity-0 group-hover:opacity-100 transition-opacity">
                        <span class="bg-stone-800 text-white text-xs px-3 py-1 rounded-full font-mono">OPEN FILE</span>
                    </div>
                </button>
            `).join('');

            container.innerHTML = `
                <div class="p-4 md:p-12 animate-fade-in">
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-black text-amber-500 mb-2">PERSONNEL DATABASE</h2>
                        <!-- Removed orange bar -->
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-12 md:gap-6 max-w-6xl mx-auto">
                        ${teamsHTML}
                    </div>
                </div>
            `;
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function renderTeamDetail() {
            const team = TEAMS[selectedTeamId];
            const members = CHARACTERS.filter(c => c.teamId === selectedTeamId);
            const container = document.getElementById('app');

            const membersHTML = members.map(char => `
                <button onclick="selectCharacter('${char.id}')" class="bg-white border border-stone-300 shadow-md hover:shadow-xl hover:border-amber-500 transition-all p-4 text-left group flex flex-col relative overflow-hidden cursor-pointer w-full">
                    <div class="absolute top-2 right-2 opacity-50">
                        <i data-lucide="fingerprint" width="32" height="32" class="text-stone-200"></i>
                    </div>
                    <div class="w-full aspect-square bg-stone-100 mb-4 overflow-hidden border border-stone-200 relative transition-all duration-500">
                        <img src="${char.avatarUrl}" alt="${char.name}" class="w-full h-full object-cover" />
                        <div class="absolute bottom-0 left-0 bg-stone-900 text-white text-xs px-2 py-1 font-mono">${char.id.toUpperCase()}</div>
                    </div>
                    <h4 class="font-bold text-lg text-stone-900 group-hover:text-amber-700">${char.name}</h4>
                    <div class="text-sm font-bold text-stone-500 mb-2">${char.rank}</div>
                </button>
            `).join('');

            container.innerHTML = `
                <div class="relative p-6 md:p-12 min-h-[600px] bg-paper-pattern bg-stone-50 shadow-inner rounded-sm">
                    ${getBackStampHTML('goBack()', 'RETURN TO INDEX')}
                    <div class="md:ml-20 mt-8 md:mt-16 mb-10 border-b-2 border-stone-300 pb-6">
                        <h2 class="text-4xl font-black ${team.themeColor} mb-2">${team.name}</h2>
                        <h3 class="text-lg font-mono text-stone-500">${team.engName}</h3>
                        <p class="mt-4 text-stone-700 max-w-2xl font-serif text-lg leading-relaxed bg-white/50 p-4 border-l-4 border-stone-400">${team.description}</p>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${membersHTML}
                    </div>
                </div>
            `;
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        function renderCharacterDetail() {
            const char = CHARACTERS.find(c => c.id === selectedCharacterId);
            const container = document.getElementById('app');
            const team = TEAMS[char.teamId];
            
            // Logic for Kim Hero Awakening -> Castel
            const isKimHero = char.id === 'CA';
            const isAwakened = isKimHero && isKimHeroAwakened;
            
            // Only photo and stats change
            const portraitUrl = isAwakened ? 'CA_cowboyshot3.png' : char.portraitUrl;
            const stats = isAwakened ? { attack: 70, defense: 99, magic: 63, admin: 30 } : char.stats;
            const maxStatValue = 100;
            
            // Fixed styles (no red text, no quote change, no background change)
            const bgClass = '';
            const titleColor = 'text-stone-900';
            const quoteBorder = 'border-amber-600';
            const quoteText = char.quote;
            
            // Visual feedback for image only
            const imageEffects = isAwakened ? 'rotate-1 scale-105 border-red-500' : '-rotate-1';
            const imageFilter = '';

            const curseLabel = char.curseLabel || '특이 사항';
            const curseSection = char.curse ? `
                <div class="bg-red-50 border border-red-200 p-4 text-red-900">
                    <h3 class="font-bold text-sm mb-1 flex items-center gap-2">
                         <i data-lucide="shield-alert" width="14" height="14"></i>
                         ${curseLabel}
                    </h3>
                    <p class="text-sm font-bold">${char.curse}</p>
                </div>
            ` : '';

            // Awakening Button HTML
            let awakeningBtn = '';
            if (isKimHero) {
                const btnClass = isAwakened 
                    ? 'bg-red-600 text-white border-red-800 animate-pulse' 
                    : 'bg-stone-200 text-stone-600 border-stone-400 hover:bg-stone-300';
                const label = isAwakened ? "방어구OFF" : "방어구ON";
                awakeningBtn = `
                    <button onclick="toggleAwakening()" class="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold border-2 transition-all shadow-sm ${btnClass}">
                        <i data-lucide="zap" width="14" height="14" fill="${isAwakened ? 'currentColor' : 'none'}"></i>
                        ${label}
                    </button>
                `;
            }

            container.innerHTML = `
                <div class="bg-folder-light shadow-2xl border border-stone-300 p-6 md:p-12 relative min-h-[900px] font-mono text-stone-800 bg-paper-pattern mx-auto max-w-5xl transition-colors duration-700 ${bgClass}">
                    ${getBackStampHTML('goBack()', 'RETURN TO TEAM')}
                    
                    <div class="border-b-4 border-double border-stone-800 pb-4 mb-8 mt-4 md:mt-12 flex flex-col md:flex-row justify-between items-start md:items-end">
                        <div>
                            <div class="flex items-center gap-4">
                                <h2 class="text-4xl font-bold font-sans tracking-tight transition-colors duration-300 ${titleColor}">
                                    ${char.name} ${isAwakened ? "(장비 착용)" : ""}
                                </h2>
                                ${awakeningBtn}
                            </div>
                            <div class="text-sm font-bold text-stone-600 mt-1 flex items-center gap-2">
                                <i data-lucide="users" width="14" height="14"></i>
                                TEAM: ${team.name}
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                        <!-- Left Col -->
                        <div class="col-span-1 lg:col-span-4">
                            <div class="bg-white p-3 shadow-lg border border-stone-200 transform transition-transform duration-500 mb-6 relative ${imageEffects}">
                                <div class="absolute -top-3 -left-2 text-stone-400 w-10 h-10">
                                    <i data-lucide="paperclip" width="40" height="40"></i>
                                </div>
                                <div class="w-full aspect-[2/3] overflow-hidden bg-stone-200 relative">
                                    <img src="${portraitUrl}" alt="${char.name}" class="w-full h-full object-cover transition-all duration-700 ${imageFilter}" />
                                </div>
                            </div>
                            <div class="bg-stone-100 border-l-4 p-4 mb-4 italic text-stone-700 font-serif text-sm shadow-sm transition-colors ${quoteBorder}">
                                "${quoteText}"
                            </div>
                        </div>

                        <!-- Right Col -->
                        <div class="col-span-1 lg:col-span-8 space-y-6">
                            <div class="bg-white border border-stone-300 p-4 shadow-sm">
                                <h3 class="font-bold text-lg border-b-2 border-stone-800 mb-3 inline-block">기본 신상 정보 (Basic Information)</h3>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div class="flex flex-col"><span class="text-stone-500 text-xs">이름 (Name)</span><span class="font-bold">${char.name}</span></div>
                                    <div class="flex flex-col"><span class="text-stone-500 text-xs">성별 (Gender)</span><span class="font-bold">${char.gender}</span></div>
                                    <div class="flex flex-col"><span class="text-stone-500 text-xs">나이 (Age)</span><span class="font-bold">${char.age}</span></div>
                                    <div class="flex flex-col"><span class="text-stone-500 text-xs">종족 (Race)</span><span class="font-bold">${char.race}</span></div>
                                    <div class="flex flex-col"><span class="text-stone-500 text-xs">클래스 (Class)</span><span class="font-bold">${char.jobClass}</span></div>
                                </div>
                            </div>

                            ${curseSection}

                            <div class="space-y-4">
                                <div class="bg-white/50 p-3 border-l-2 border-stone-400">
                                    <h4 class="font-bold text-stone-600 text-xs mb-1 uppercase">외관 (Appearance)</h4>
                                    <p class="text-sm text-stone-800 leading-relaxed">${char.appearance}</p>
                                </div>
                                <div class="bg-white/50 p-3 border-l-2 border-stone-400">
                                    <h4 class="font-bold text-stone-600 text-xs mb-1 uppercase">성격 (Personality)</h4>
                                    <p class="text-sm text-stone-800 leading-relaxed">${char.personality}</p>
                                </div>
                                <div class="bg-white/50 p-3 border-l-2 border-stone-400">
                                    <h4 class="font-bold text-stone-600 text-xs mb-1 uppercase">특징 (Features)</h4>
                                    <p class="text-sm text-stone-800 leading-relaxed">${char.features}</p>
                                </div>
                            </div>

                            <div class="p-4 bg-white border border-stone-200 mt-4 transition-all duration-500 ${isAwakened ? 'ring-2 ring-red-400 shadow-xl' : ''}">
                                <h3 class="font-bold text-lg border-b-2 border-stone-800 mb-4 inline-block">직무 능력 평가표 (Performance Stats)</h3>
                                <div class="space-y-3">
                                    ${getStatBarHTML("공격력", stats.attack, maxStatValue)}
                                    ${getStatBarHTML("방어력", stats.defense, maxStatValue)}
                                    ${getStatBarHTML("마력", stats.magic, maxStatValue)}
                                    ${getStatBarHTML("행정력", stats.admin, maxStatValue)}
                                </div>
                            </div>

                            <div class="mt-8 flex justify-end">
                                <div class="text-center">
                                    <div class="w-40 h-16 border-b border-stone-800 mb-2 font-handwriting text-2xl text-blue-900 transform -rotate-6 pt-4">Approved</div>
                                    <div class="text-xs uppercase font-bold tracking-wider">Director Signature</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            if (window.lucide) {
                lucide.createIcons();
            }
        }

        // --- INIT ---
        window.addEventListener('DOMContentLoaded', () => {
            initRouter();
        });
    </script>
</body>
</html>
